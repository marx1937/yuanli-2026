{% extends "base.html" %}
{% set active_page = "home" %}

{% block styles %}
<style>
    /* é ‚éƒ¨æ©«å¹…å€ */
    .hero-section { position: relative; width: 100%; overflow: hidden; margin-bottom: -5px; }
    .hero-img { width: 100%; display: block; height: auto; object-fit: cover; }
    
    /* æ¨™é¡Œå€ */
    .title-section { text-align: center; padding: 20px 0; position: relative; z-index: 10; }
    .main-title { 
        font-size: 2.8rem; font-weight: 900; color: #5d4037; 
        font-family: 'Brush Script MT', cursive; 
        text-shadow: 2px 2px 0px #fff, 4px 4px 0px rgba(0,0,0,0.1);
        margin: 0; letter-spacing: 2px;
    }
    
    /* æŒ‰éˆ•å®¹å™¨ */
    .menu-container { padding: 10px 15px; display: flex; flex-direction: column; gap: 15px; }

    /* åŠŸèƒ½å¡ç‰‡é€šç”¨æ¨£å¼ */
    .menu-card {
        background: #fff; border-radius: 20px; padding: 15px 20px;
        display: flex; align-items: center; justify-content: space-between;
        box-shadow: 0 5px 15px rgba(93, 64, 55, 0.08);
        border: 2px solid #fff; transition: transform 0.2s;
        text-decoration: none; position: relative; overflow: hidden;
    }
    .menu-card:active { transform: scale(0.98); background: #fafafa; }

    /* å„åˆ¥å¡ç‰‡é…è‰² */
    .card-map { border-color: #ffe0b2; background: linear-gradient(to right, #fffbf0, #fff); }
    .card-upload { background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%); color: white; border: none; box-shadow: 0 8px 20px rgba(198, 40, 40, 0.3); }
    .card-gallery { border-color: #ffccbc; }
    .card-rank { border-color: #c8e6c9; }

    /* æ–‡å­—æ¨£å¼ */
    .card-text { flex: 1; margin-left: 15px; }
    .card-title { font-size: 1.2rem; font-weight: 800; margin-bottom: 3px; display: block; }
    .card-desc { font-size: 0.85rem; opacity: 0.8; font-weight: normal; }
    .card-icon-img { width: 65px; height: 65px; object-fit: contain; }

    /* PWA å¹³å®‰ç¬¦æŒ‰éˆ• (åªåœ¨é¦–é ) */
    #pwa-install-btn {
        display: none; /* JS æœƒæ§åˆ¶é¡¯ç¤º */
        position: fixed; bottom: 115px; right: 15px; z-index: 2100; 
        cursor: pointer; transform-origin: top center;
        animation: windChime 3.5s ease-in-out infinite;
        filter: drop-shadow(2px 5px 5px rgba(0,0,0,0.2));
    }
    #pwa-install-btn img { width: 60px; height: auto; transition: transform 0.2s; }
    #pwa-install-btn:active { animation: none; transform: scale(0.95); }
    @keyframes windChime {
        0% { transform: rotate(0deg); } 25% { transform: rotate(4deg); }
        50% { transform: rotate(0deg); } 75% { transform: rotate(-4deg); } 100% { transform: rotate(0deg); }
    }

    /* è«‹ç¥ç­‰å¾…ç•«é¢ (åªåœ¨é¦–é ) */
    #loading-layer {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
        background: #fffbf0; z-index: 9999;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        transition: opacity 0.5s ease-out;
    }
    .loading-god { width: 150px; animation: float 2s ease-in-out infinite; }
    .loading-text { margin-top: 20px; color: #d32f2f; font-weight: bold; font-size: 1.1rem; text-align: center; line-height: 1.6; }
    .loading-subtext { color: #8d6e63; font-size: 0.9rem; margin-top: 5px; }
    .spinner { margin-top: 15px; width: 30px; height: 30px; border: 4px solid #f3f3f3; border-top: 4px solid #d32f2f; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
</style>
{% endblock %}

{% block content %}

    <div id="loading-layer">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1768525265/logo.png" class="loading-god">
        <div class="loading-text">
            åœŸåœ°å…¬æ­£åœ¨ç©¿é‹å­...<br>
            <span style="font-size:0.9rem; color:#555;">(è³‡æ–™é€£ç·šä¸­ï¼Œè«‹ç¨å€™)</span>
        </div>
        <div class="spinner"></div>
        <div class="loading-subtext" id="loading-hint">å¦‚æœç­‰å¤ªä¹…ï¼Œå¯èƒ½æ˜¯åœŸåœ°å…¬é‚„åœ¨ç¡è¦º... ğŸ˜´</div>
    </div>

    <div id="pwa-install-btn" onclick="showInstallGuide()">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/install_amulet.png" alt="ä¸‹è¼‰APP">
    </div>

    <div class="hero-section">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/banner_top.jpg" class="hero-img">
    </div>

    <div class="title-section">
        <h1 class="main-title">MAP MY GOD</h1>
        <div style="margin-top:5px;">
            <span style="background:#fff; padding:5px 15px; border-radius:20px; color:#8d6e63; font-weight:bold; font-size:0.9rem; border:1px solid #eee;">
                è€ç¥åœ¨åœ¨ ğŸ èº²è²“è²“
            </span>
        </div>
    </div>

    <div class="menu-container">
        
        <a href="/map" class="menu-card card-map">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/icon_map_couple.png" class="card-icon-img">
            <div class="card-text">
                <span class="card-title" style="color:#e65100;">æœå°‹æ–¹ä½</span>
                <span class="card-desc" style="color:#ef6c00;">çœ‹çœ‹ä»–å€‘èº²åœ¨å“ª</span>
            </div>
            <i class="fas fa-map-marked-alt" style="color:#ffe0b2; font-size:1.5rem;"></i>
        </a>

        <a href="/upload" class="menu-card card-upload">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/icon_camera_couple.png" class="card-icon-img">
            <div class="card-text">
                <span class="card-title">å°‹æ‰¾ç¥éšŠå‹</span>
                <span class="card-desc" style="color:rgba(255,255,255,0.9);">è¶•å¿«å¹«ç¥‚æ‹å¼µç…§</span>
                <div style="margin-top:5px;">
                    <span style="background:#fdd835; color:#c62828; font-size:0.75rem; padding:2px 8px; border-radius:4px; font-weight:bold; transform: rotate(-5deg); display:inline-block;">LUCKY!</span>
                </div>
            </div>
            <i class="fas fa-chevron-right"></i>
        </a>

        <a href="/gallery" class="menu-card card-gallery">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/icon_album_couple.png" class="card-icon-img">
            <div class="card-text">
                <span class="card-title" style="color:#4e342e;">å½±åƒåº«</span>
                <span class="card-desc">å°‹ç¥è¶³è·¡ç´€éŒ„</span>
            </div>
            <i class="fas fa-images" style="color:#ffccbc; font-size:1.5rem;"></i>
        </a>

        <a href="/leaderboard" class="menu-card card-rank">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/icon_rank_boy.png" class="card-icon-img">
            <div class="card-text">
                <span class="card-title" style="color:#2e7d32;">è‹±é›„æ¦œ</span>
                <span class="card-desc">èª°æ˜¯å°‹ç¥é”äºº</span>
            </div>
            <i class="fas fa-trophy" style="color:#c8e6c9; font-size:1.5rem;"></i>
        </a>

    </div>

{% endblock %}

{% block scripts %}
<script>
    // å®‰è£æŒ‰éˆ•é¡¯ç¤ºé‚è¼¯
    function checkInstallState() {
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        // å¦‚æœä¸æ˜¯ App æ¨¡å¼ï¼Œå°±é¡¯ç¤ºæŒ‰éˆ•
        if (!isStandalone) {
            document.getElementById('pwa-install-btn').style.display = 'block';
        }
    }
    
    // å®‰è£æ•™å­¸å½ˆçª—
    window.showInstallGuide = function() {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
            Swal.fire({
                title: 'ğŸ“² å®‰è£åˆ° iPhone',
                html: `<div style="text-align:left;">1. é»æ“Šä¸‹æ–¹ <b>åˆ†äº«</b> <i class="fas fa-share-square"></i><br>2. å¾€ä¸‹æ»‘é¸ <b>åŠ å…¥ä¸»ç•«é¢</b> <i class="far fa-plus-square"></i><br>3. é»æ“Š <b>æ–°å¢</b> å³å¯ï¼</div>`,
                imageUrl: 'https://res.cloudinary.com/diuoghid2/image/upload/v1768525265/logo.png',
                imageWidth: 80, confirmButtonText: 'å¥½ï¼'
            });
        } else {
            Swal.fire({
                title: 'ğŸ“² å®‰è£åˆ°æ‰‹æ©Ÿ',
                html: `<div style="text-align:left;">1. é»æ“Šå³ä¸Šè§’ <b>é¸å–®</b> <i class="fas fa-ellipsis-v"></i><br>2. é»é¸ <b>åŠ åˆ°ä¸»ç•«é¢</b> æˆ– <b>å®‰è£æ‡‰ç”¨ç¨‹å¼</b><br>3. ç¢ºèªå®‰è£å³å¯ï¼</div>`,
                imageUrl: 'https://res.cloudinary.com/diuoghid2/image/upload/v1768525265/logo.png',
                imageWidth: 80, confirmButtonText: 'å¥½ï¼Œæˆ‘è©¦è©¦', confirmButtonColor: '#2e7d32'
            });
        }
    }
    
    // å•Ÿå‹•æª¢æŸ¥
    checkInstallState();

    // ç§»é™¤ç­‰å¾…ç•«é¢ (è®“é¦–é å¯ä»¥æ»‘å‹•)
    window.addEventListener('load', function() {
        var loader = document.getElementById('loading-layer');
        var hint = document.getElementById('loading-hint');
        setTimeout(function() {
            loader.style.opacity = '0'; 
            setTimeout(function() { loader.style.display = 'none'; }, 500); 
        }, 800); 
        
        setTimeout(function() {
            if(loader.style.display !== 'none') {
                hint.innerHTML = "å…è²»ä¼ºæœå™¨å–šé†’ä¸­...<br>ç¬¬ä¸€æ¬¡æœƒæ¯”è¼ƒä¹…ï¼Œè«‹å–å£èŒ¶ğŸµ";
            }
        }, 5000);
    });
</script>
{% endblock %}
