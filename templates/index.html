{% extends "base.html" %}
{% set active_page = "index" %}

{% block title %}å°‹ç¥æƒ…å ±ç«™ (Hç‰ˆ){% endblock %}

{% block styles %}
<style>
    /* 1. èƒŒæ™¯é‚„åŸ (ç¶“å…¸ç±³è‰²é»é») */
    body {
        background-color: #fdfcf0;
        background-image: radial-gradient(#d7ccc8 1.5px, transparent 1.5px);
        background-size: 24px 24px;
        font-family: "Microsoft JhengHei", sans-serif;
    }

    /* 2. é ‚éƒ¨å ±é¦¬ä»”æ©«å¹… (åŸæœ¬æ˜¯æ­¡è¿è©ï¼Œç¾åœ¨è®Šè°æ˜äº†) */
    .hero-banner {
        background: #fff8e1;
        border: 2px solid #ffe0b2;
        border-radius: 20px;
        padding: 15px;
        margin: 20px 20px 10px 20px;
        display: flex;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        cursor: pointer;
    }
    .hero-mascot { width: 50px; margin-right: 15px; }
    .hero-text { color: #5d4037; font-weight: bold; font-size: 1rem; flex: 1; }

    /* 3. å¡ç‰‡é€šç”¨æ¨£å¼ (é‚„åŸæˆªåœ–é¢¨æ ¼) */
    .card-btn {
        display: flex;
        align-items: center;
        border-radius: 25px;
        padding: 20px;
        margin: 15px 20px;
        text-decoration: none !important;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .card-btn:active { transform: scale(0.98); }

    /* ç´…è‰²å¡ç‰‡ (å°‹æ‰¾ç¥éšŠå‹) */
    .card-red {
        background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);
        color: white;
    }
    
    /* é»ƒè‰²å¡ç‰‡ (æœå°‹æ–¹ä½) */
    .card-yellow {
        background: #fff9c4;
        border: 2px solid #fff176;
        color: #5d4037;
    }

    /* ç™½è‰²å¡ç‰‡ (å½±åƒåº«) */
    .card-white {
        background: #fff;
        border: 2px solid #eee;
        color: #5d4037;
    }

    /* å¡ç‰‡å…§å®¹æ’ç‰ˆ */
    .card-img { width: 90px; height: 90px; object-fit: contain; margin-right: 15px; }
    .card-info { flex: 1; }
    .card-title { font-size: 1.5rem; font-weight: bold; display: block; margin-bottom: 5px; }
    .card-desc { font-size: 0.95rem; opacity: 0.9; }

    /* Lucky æ¨™ç±¤ */
    .lucky-tag {
        position: absolute; top: 15px; right: -25px;
        background: #f1c40f; color: #d35400;
        font-weight: bold; padding: 5px 40px;
        transform: rotate(15deg); font-size: 0.8rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* åº•éƒ¨å€åŸŸ */
    .footer-area { text-align: center; padding: 20px 0 120px 0; }
    
    .btn-contact {
        display: inline-block;
        background: #fff; border: 1px solid #d7ccc8;
        color: #8d6e63; padding: 8px 20px;
        border-radius: 50px; font-size: 0.9rem;
        margin-bottom: 15px; text-decoration: none;
    }

    .footer-text { color: #b0bec5; font-size: 0.85rem; }
    
    /* ğŸ”¥ æ­£å­—æ¨™è¨˜ Â® */
    .mark-r { 
        color: #d32f2f; font-weight: bold; vertical-align: super; font-size: 0.7rem; margin-left: 2px;
    }
</style>
{% endblock %}

{% block content %}

    <div class="hero-banner" onclick="location.reload()">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_camera.png" class="hero-mascot">
        <div class="hero-text" id="news-ticker">
            <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨é€£ç·š Hotmail ç¸½éƒ¨...
        </div>
        <i class="fas fa-chevron-right" style="color:#d7ccc8;"></i>
    </div>

    <a href="/upload" class="card-btn card-red">
        <div class="lucky-tag">LUCKY!</div>
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_camera.png" class="card-img">
        <div class="card-info">
            <span class="card-title">å°‹æ‰¾ç¥éšŠå‹</span>
            <span class="card-desc">è¶•å¿«å¹«ç¥‚æ‹å¼µç…§</span>
        </div>
    </a>

    <a href="/map" class="card-btn card-yellow">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_map.png" class="card-img">
        <div class="card-info">
            <span class="card-title">æœå°‹æ–¹ä½</span>
            <span class="card-desc">çœ‹çœ‹ä»–å€‘èº²åœ¨å“ª</span>
        </div>
        <i class="fas fa-map-marked-alt" style="font-size:1.5rem; color:#fbc02d;"></i>
    </a>

    <a href="/gallery" class="card-btn card-white">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_couple.png" class="card-img">
        <div class="card-info">
            <span class="card-title">å½±åƒåº«</span>
            <span class="card-desc">å°‹ç¥è¶³è·¡ç´€éŒ„</span>
        </div>
        <i class="fas fa-images" style="font-size:1.5rem; color:#bdbdbd;"></i>
    </a>

    <div class="footer-area">
        <a href="#" class="btn-contact"><i class="fab fa-facebook-messenger"></i> è¯çµ¡å°ç·¨ (ç§è¨Š)</a>
        <div class="footer-text">
            2026 è‹‘è£¡ä¸²èµ·ä¾†<span class="mark-r">Â®</span> (Hotmail Ver.)
            <i class="fas fa-lock" style="font-size:0.7rem; margin-left:5px;"></i>
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // ğŸ”¥ è°æ˜å ±é¦¬ä»”é‚è¼¯ï¼šæŠ“å–æœ€æ–°ä¸€ç­†è³‡æ–™
        $.getJSON('/api/locations', function(data) {
            if (data && data.length > 0) {
                var latest = data[data.length - 1]; 
                
                // 1. æŠ“æš±ç¨±
                var nickname = latest.nickname || "ç†±å¿ƒé„‰è¦ª";
                
                // 2. æŠ“åœ°é» (é‚è¼¯ï¼šå˜—è©¦å¾ [xxxé‡Œ] ä¸­æŠ“å‡ºæ–‡å­—)
                var area = "è‹‘è£¡æŸè™•";
                var desc = latest.description || "";
                
                // å¦‚æœæ ¼å¼æ˜¯ "[è‹‘å—é‡Œ] ç™¼ç¾..."ï¼Œæˆ‘å€‘å°±æŠŠæ‹¬è™Ÿè£¡çš„å­—æŠ“å‡ºä¾†
                if (desc.indexOf(']') > -1) {
                    var parts = desc.split(']');
                    if (parts.length > 0) {
                        area = parts[0].replace('[', ''); // æŠ“å‡º "è‹‘å—é‡Œ"
                    }
                }

                // 3. é¡¯ç¤ºåœ¨é ‚éƒ¨æ©«å¹…
                $('#news-ticker').html(`
                    <span style="color:#e65100;">æœ€æ–°æƒ…å ±ï¼š</span><br>
                    <b>${nickname}</b> åœ¨ <b>${area}</b> ç™¼ç¾äº†åœŸåœ°å…¬ï¼
                `);
            } else {
                $('#news-ticker').html("ç›®å‰å°šç„¡æƒ…å ±<br>æ­¡è¿ä¾†åˆ°å°‹ç¥æƒ…å ±ç«™ï¼");
            }
        }).fail(function() {
            $('#news-ticker').text("æ­¡è¿ä¾†åˆ°å°‹ç¥æƒ…å ±ç«™ï¼");
        });
    });
</script>
{% endblock %}
