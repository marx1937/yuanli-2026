{% extends "base.html" %}
{% set active_page = "index" %}

{% block title %}å°‹ç¥æƒ…å ±ç«™ (Hç‰ˆ){% endblock %}

{% block styles %}
<style>
    /* 1. å…¨å±€èƒŒæ™¯ */
    body {
        background-color: #fdfcf0;
        background-image: radial-gradient(#d7ccc8 1.5px, transparent 1.5px);
        background-size: 24px 24px;
        font-family: "Microsoft JhengHei", sans-serif;
        overflow-x: hidden;
    }

    /* ğŸ”¥ 2. Splash Screen (é€²å ´ç•«é¢) */
    #splash-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: #fff8e1;
        z-index: 9999;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        transition: opacity 0.8s ease-out;
    }
    .splash-logo { width: 120px; animation: breathe 2s infinite ease-in-out; }
    .splash-text { margin-top: 20px; color: #8d6e63; font-weight: bold; letter-spacing: 2px; font-size: 0.9rem; }
    @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } }

    /* 3. Hero å€å¡Š */
    .hero-section {
        position: relative; text-align: center; padding-top: 20px; margin-bottom: 10px;
    }
    .hero-banner-img {
        width: 100%; max-width: 400px; height: auto; display: block; margin: 0 auto;
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }
    
    /* è€ç¥åœ¨åœ¨ç‹€æ…‹åˆ— (god_cute.png) */
    .status-bar {
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid #ffe0b2;
        border-radius: 50px; padding: 5px 20px; display: inline-flex; align-items: center;
        margin-top: -15px; position: relative; z-index: 2;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .god-icon { width: 28px; margin-right: 8px; }
    .status-text { font-size: 0.85rem; color: #5d4037; font-weight: bold; }

    /* 4. å ±é¦¬ä»”å€å¡Š (bm.png) - å¾©åˆ»æˆªåœ–çš„ç±³é»ƒè‰² */
    .notice-bar {
        background: #fff8e1; 
        border: 2px solid #ffe0b2;
        border-radius: 20px; 
        padding: 12px 15px; 
        margin: 15px 20px;
        display: flex; align-items: center; 
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05); 
        transition: transform 0.1s;
    }
    .notice-bar:active { transform: scale(0.98); }
    .bm-icon { width: 50px; margin-right: 15px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); } 
    .notice-content { flex: 1; font-size: 0.95rem; color: #5d4037; font-weight: bold; line-height: 1.4; }

    /* 5. å¡ç‰‡æŒ‰éˆ• */
    .menu-grid { display: flex; flex-direction: column; gap: 15px; padding: 0 20px; }
    .card-btn {
        display: flex; align-items: center; border-radius: 25px; padding: 15px 25px;
        text-decoration: none !important; position: relative; overflow: hidden;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1); transition: transform 0.2s; height: 110px;
    }
    .card-btn:active { transform: scale(0.98); }

    .card-red { background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%); color: white; }
    .card-yellow { background: #fff9c4; border: 2px solid #fff176; color: #5d4037; }
    .card-white { background: #fff; border: 2px solid #eee; color: #5d4037; }

    /* ä½¿ç”¨æŒ‡å®šçš„ icon_*.png */
    .card-icon { width: 80px; height: 80px; object-fit: contain; margin-right: 20px; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); }
    .card-info span { display: block; }
    .card-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; }
    .card-desc { font-size: 0.9rem; opacity: 0.9; }

    .lucky-tag {
        position: absolute; top: 15px; right: -30px;
        background: #f1c40f; color: #d35400; font-weight: bold;
        padding: 5px 40px; transform: rotate(15deg); font-size: 0.8rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* 6. åº•éƒ¨ç¤¾ç¾¤ (ç§è¨Š + ç²‰çµ²åœ˜é€£çµ) */
    .footer-area { text-align: center; padding: 30px 0 120px 0; }
    
    /* ç§è¨ŠæŒ‰éˆ• */
    .btn-messenger {
        display: inline-flex; align-items: center; justify-content: center;
        background: #0084ff; color: white; 
        padding: 12px 30px; border-radius: 50px;
        font-weight: bold; text-decoration: none; font-size: 1rem;
        box-shadow: 0 5px 15px rgba(0, 132, 255, 0.3); 
        margin-bottom: 20px; transition: 0.2s;
    }
    .btn-messenger:active { transform: scale(0.95); }
    
    /* ç²‰çµ²åœ˜æ–‡å­—é€£çµ */
    .footer-link {
        color: #b0bec5; font-size: 0.9rem; text-decoration: none;
        display: block; margin-top: 5px; font-weight: bold;
    }
    .footer-link:hover { color: #d32f2f; text-decoration: underline; }
    .mark-r { color: #d32f2f; font-weight: bold; vertical-align: super; font-size: 0.7rem; }
</style>
{% endblock %}

{% block content %}
    
    <div id="splash-screen">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/logo.png" class="splash-logo" alt="Loading...">
        <div class="splash-text">2026 è‹‘è£¡ä¸²èµ·ä¾† (Hç‰ˆ)</div>
    </div>

    <div class="hero-section">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/top.png" class="hero-banner-img" alt="Map My God">
        <div class="status-bar">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/god_cute.png" class="god-icon" alt="God">
            <span class="status-text" id="system-status">é€£ç·š Hotmail ç¸½éƒ¨ä¸­...</span>
        </div>
    </div>

    <div class="notice-bar" onclick="location.href='/map'">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/bm.png" class="bm-icon" alt="Ticker">
        <div class="notice-content" id="news-ticker">
            <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æ¥æ”¶æœ€æ–°æƒ…å ±...
        </div>
        <i class="fas fa-chevron-right" style="color: #d7ccc8; margin-left: auto;"></i>
    </div>

    <div class="menu-grid">
        <a href="/upload" class="card-btn card-red">
            <div class="lucky-tag">LUCKY!</div>
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/icon_camera.png" class="card-icon" alt="Camera">
            <div class="card-info">
                <span class="card-title">å°‹æ‰¾ç¥éšŠå‹</span>
                <span class="card-desc">æ‹ç…§ä¸Šå‚³æ‹¿å¥½é‹</span>
            </div>
        </a>

        <a href="/map" class="card-btn card-yellow">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/icon_compass.png" class="card-icon" alt="Compass">
            <div class="card-info">
                <span class="card-title">æœå°‹æ–¹ä½</span>
                <span class="card-desc">çœ‹çœ‹ä»–å€‘èº²åœ¨å“ª</span>
            </div>
        </a>

        <a href="/gallery" class="card-btn card-white">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/yuanli_ui/icon_album.png" class="card-icon" alt="Album">
            <div class="card-info">
                <span class="card-title">å½±åƒåº«</span>
                <span class="card-desc">å°‹ç¥è¶³è·¡ç´€éŒ„</span>
            </div>
        </a>
    </div>

    <div class="footer-area">
        <a href="https://m.me/Yuanli.Together.Club" target="_blank" class="btn-messenger">
            <i class="fab fa-facebook-messenger" style="margin-right:8px; font-size:1.2rem;"></i> è¯çµ¡å°ç·¨ (ç§è¨Š)
        </a>
        
        <a href="https://www.facebook.com/Yuanli.Together.Club" target="_blank" class="footer-link">
            2026 è‹‘è£¡ä¸²èµ·ä¾†<span class="mark-r">Â®</span> ç²‰çµ²åœ˜
        </a>
    </div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Splash å‹•ç•«æ§åˆ¶
    window.addEventListener('load', function() {
        setTimeout(function() {
            var splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(function() { splash.style.display = 'none'; }, 800);
        }, 1500);
    });

    // å ±é¦¬ä»”é€£ç·šé‚è¼¯
    $(document).ready(function() {
        $.getJSON('/api/locations', function(data) {
            $('#system-status').html('Hç‰ˆå°ˆç·šæš¢é€š');
            
            if (data && data.length > 0) {
                var latest = data[data.length - 1]; 
                var nickname = latest.nickname || "ç†±å¿ƒé„‰è¦ª";
                var area = "è‹‘è£¡æŸè™•";
                var desc = latest.description || "";
                
                if (desc.indexOf(']') > -1) {
                    var parts = desc.split(']');
                    if (parts.length > 0) area = parts[0].replace('[', ''); 
                }

                $('#news-ticker').html(`
                    <span style="color:#e65100;">æœ€æ–°æƒ…å ±ï¼š</span><br>
                    <b>${nickname}</b> åœ¨ <b>${area}</b> ç™¼ç¾äº†ç¥è¹Ÿï¼
                `);
            } else {
                $('#news-ticker').html("æ­¡è¿ä¾†åˆ°å°‹ç¥æƒ…å ±ç«™ï¼<br><span style='font-size:0.85rem;font-weight:normal;color:#8d6e63;'>ç›®å‰å°šç„¡æƒ…å ±ï¼Œå¿«ä¾†æ¶é ­é¦™</span>");
            }
        }).fail(function() {
            $('#system-status').text("é›¢ç·šæ¨¡å¼");
            $('#news-ticker').text("æ­¡è¿ä¾†åˆ°å°‹ç¥æƒ…å ±ç«™ï¼");
        });
    });
</script>
{% endblock %}
