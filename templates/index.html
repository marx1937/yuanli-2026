{% extends "base.html" %}
{% set active_page = "index" %}

{% block title %}å°‹ç¥æƒ…å ±ç«™ (Hç‰ˆ){% endblock %}

{% block styles %}
<style>
    /* 1. æš–è‰²ç³»èƒŒæ™¯ */
    body {
        background-color: #fdfcf0;
        background-image: radial-gradient(#d7ccc8 1.5px, transparent 1.5px);
        background-size: 24px 24px;
        font-family: "Microsoft JhengHei", sans-serif;
    }

    /* Hero å€å¡Š */
    .hero-section {
        text-align: center;
        padding: 30px 0 20px 0;
        margin-bottom: 10px;
    }
    
    /* æ¨™é¡Œ */
    .app-title {
        font-family: 'Brush Script MT', cursive; 
        font-size: 3.2rem; 
        color: #5d4037; 
        margin: 0; 
        text-shadow: 2px 2px 0px #fff;
    }

    /* ç‹€æ…‹é¡¯ç¤º */
    .status-text {
        font-size: 0.9rem;
        color: #8d6e63;
        margin-top: 10px;
        background: rgba(255,255,255,0.6);
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
    }

    /* ğŸ”¥ å ±é¦¬ä»”è·‘é¦¬ç‡ˆ (è°æ˜ç‰ˆ) */
    .notice-bar {
        background: #fff3e0;
        color: #e65100;
        padding: 12px 20px;
        border-radius: 15px;
        margin: 0 20px 20px 20px;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        border: 1px dashed #ffcc80;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(230, 126, 34, 0.1);
        overflow: hidden;
        white-space: nowrap;
    }
    .notice-icon { margin-right: 10px; animation: tada 1.5s infinite; color: #d35400; }
    
    @keyframes tada {
        0% { transform: scale(1); }
        10%, 20% { transform: scale(0.9) rotate(-3deg); }
        30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
        40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
        100% { transform: scale(1) rotate(0); }
    }

    /* å¡ç‰‡é€šç”¨è¨­å®š */
    .action-card {
        margin: 0 20px 20px 20px;
        border-radius: 25px;
        padding: 25px 20px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none !important;
        transition: transform 0.2s;
    }
    .action-card:active { transform: scale(0.98); }

    /* ç´…è‰² Lucky å¡ç‰‡ */
    .card-lucky {
        background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);
        color: white;
        box-shadow: 0 10px 25px rgba(211, 47, 47, 0.3);
    }
    .lucky-tag {
        position: absolute; right: -25px; top: 15px;
        background: #f1c40f; color: #d35400;
        font-weight: bold; padding: 5px 40px;
        transform: rotate(15deg);
        font-size: 0.8rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* é»ƒè‰²åœ°åœ–å¡ç‰‡ */
    .card-map {
        background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
        color: #5d4037;
        box-shadow: 0 10px 25px rgba(255, 193, 7, 0.2);
    }
    
    /* å½±åƒåº«å¡ç‰‡ */
    .card-gallery {
        background: #fff;
        border: 2px solid #eee;
        color: #5d4037;
    }

    .card-text { flex: 1; margin-left: 15px; }
    .card-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 5px; display: block; }
    .card-desc { font-size: 0.9rem; opacity: 0.9; }
    .card-icon { width: 70px; height: 70px; object-fit: contain; }

    /* ğŸ”¥ åº•éƒ¨ç‰ˆæ¬Šå€èˆ‡ R æ¨™è¨˜ */
    .footer-mark {
        text-align: center;
        color: #b0bec5;
        font-size: 0.85rem;
        margin-top: 20px;
        padding-bottom: 120px; /* é¿é–‹åº•éƒ¨é¸å–® */
    }
    .r-mark {
        color: #d32f2f;
        font-weight: bold;
        font-size: 1rem;
        vertical-align: super;
        margin-left: 2px;
    }
</style>
{% endblock %}

{% block content %}
    <div class="hero-section">
        <h1 class="app-title">MAP MY GOD</h1>
        <div class="status-text" id="system-status">
            <i class="fas fa-satellite-dish"></i> é€£ç·š Hotmail ç¸½éƒ¨ä¸­...
        </div>
    </div>

    <div class="notice-bar" onclick="location.href='/map'">
        <i class="fas fa-bullhorn notice-icon"></i>
        <div id="news-ticker" style="overflow: hidden; text-overflow: ellipsis;">
            æ­£åœ¨æ¥æ”¶æœ€æ–°æƒ…å ±...
        </div>
        <i class="fas fa-chevron-right" style="margin-left: auto; font-size: 0.8rem; opacity: 0.6;"></i>
    </div>

    <a href="/upload" class="action-card card-lucky">
        <div class="lucky-tag">LUCKY!</div>
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_camera.png" class="card-icon" alt="Lucky">
        <div class="card-text">
            <span class="card-title">å°‹æ‰¾ç¥éšŠå‹</span>
            <span class="card-desc">è¶•å¿«å¹«ç¥‚æ‹å¼µç…§</span>
        </div>
        <i class="fas fa-camera" style="font-size: 1.5rem; opacity: 0.8;"></i>
    </a>

    <a href="/map" class="action-card card-map">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_map.png" class="card-icon" alt="Map">
        <div class="card-text">
            <span class="card-title">æœå°‹æ–¹ä½</span>
            <span class="card-desc">çœ‹çœ‹ä»–å€‘èº²åœ¨å“ª</span>
        </div>
        <i class="fas fa-map-marked-alt" style="color: #ffb300; font-size: 1.5rem;"></i>
    </a>

    <a href="/gallery" class="action-card card-gallery">
        <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/mascot_couple.png" class="card-icon" alt="Gallery">
        <div class="card-text">
            <span class="card-title">å½±åƒåº«</span>
            <span class="card-desc">å›é¡§ç¥è¹Ÿç´€éŒ„</span>
        </div>
        <i class="fas fa-images" style="color: #bdbdbd; font-size: 1.5rem;"></i>
    </a>

    <div class="footer-mark">
        2026 è‹‘è£¡ä¸²èµ·ä¾†<span class="r-mark">Â®</span> (Hotmail Ver.)
        <br>
        <span style="font-size:0.7rem; opacity:0.6;">Design for Yuanli</span>
    </div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $.getJSON('/api/locations', function(data) {
            // 1. æ›´æ–°é€£ç·šç‹€æ…‹
            $('#system-status').html('<i class="fas fa-check-circle" style="color:#2ecc71;"></i> Hotmail å°ˆç·šæš¢é€š');
            
            // 2. è°æ˜å ±é¦¬ä»”é‚è¼¯
            if (data && data.length > 0) {
                var latest = data[data.length - 1]; 
                
                // æŠ“å–æš±ç¨±
                var nickname = latest.nickname || "ç†±å¿ƒé„‰è¦ª";
                
                // ğŸ”¥ å˜—è©¦å¾æè¿°ä¸­æŠ“å–åœ°é» [åœ°é»]
                var area = "è‹‘è£¡æŸè™•";
                var desc = latest.description || "";
                
                // å¦‚æœæè¿°æ ¼å¼æ˜¯ "[è‹‘å—é‡Œ] ç™¼ç¾..."ï¼Œæˆ‘å€‘å°±æŠŠæ‹¬è™Ÿè£¡çš„å­—æŠ“å‡ºä¾†
                if (desc.indexOf(']') > -1) {
                    var parts = desc.split(']');
                    if (parts.length > 0) {
                        area = parts[0].replace('[', ''); // æŠ“å‡º "è‹‘å—é‡Œ"
                    }
                }

                // çµ„åˆæ–°çš„æƒ…å ±æ–‡å­—
                var newsText = `æœ€æ–°ï¼š${nickname} åœ¨ã€${area}ã€‘ç™¼ç¾äº†åœŸåœ°å…¬ï¼`;
                
                $('#news-ticker').html(`
                    <span style="color:#d35400; font-weight:bold;">${newsText}</span>
                `);
            } else {
                $('#news-ticker').text("ç›®å‰å°šç„¡æƒ…å ±ï¼Œå¿«ä¾†æ¶é ­é¦™ï¼");
            }
        }).fail(function() {
            $('#system-status').text("âš ï¸ è¨Šè™Ÿå¾®å¼±");
            $('#news-ticker').text("å ±é¦¬ä»”ä¼‘æ¯ä¸­...");
        });
    });
</script>
{% endblock %}
