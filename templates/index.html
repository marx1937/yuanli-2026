<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map My God - è‹‘è£¡åœŸåœ°å…¬</title>
    
    <link rel="manifest" href="/static/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#d32f2f">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <style>
        body { 
            /* èƒŒæ™¯ï¼šå……æ»¿æ´»åŠ›çš„æš–è‰²æ¼¸å±¤ */
            background: linear-gradient(135deg, #fff1eb 0%, #ace0f9 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: "Microsoft JhengHei", sans-serif;
            padding-bottom: 70px; /* ç•™çµ¦åº•éƒ¨å°è¦½åˆ—ç©ºé–“ */
        }
        .main-logo {
            width: 140px; height: 140px;
            background: white; border-radius: 50%;
            padding: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            margin-bottom: 10px; margin-top: 30px;
            object-fit: contain;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .app-title {
            text-align: center; margin-bottom: 25px;
        }
        .menu-btn {
            width: 85%; max-width: 320px; margin-bottom: 15px;
            display: block; text-decoration: none; text-align: center;
            transition: transform 0.1s;
        }
        .menu-btn:active { transform: scale(0.96); }
        
        /* åº•éƒ¨å°è¦½åˆ— */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 10px 0; display: flex; justify-content: space-around; z-index: 999; }
        .nav-item { text-align: center; color: #666; text-decoration: none; font-size: 0.8rem; flex: 1; }
        .nav-item i { display: block; font-size: 1.2rem; margin-bottom: 2px; }
        .nav-item.active { color: #d32f2f; font-weight: bold; }

        /* ğŸ“² ä¸‹è¼‰ APP æ‡¸æµ®æŒ‰éˆ• */
        .install-btn {
            position: fixed; top: 15px; right: 15px;
            background: #2ecc71; color: white;
            border: none; border-radius: 20px;
            padding: 6px 14px; font-size: 0.85rem; font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            z-index: 1000; animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-5px);}
            60% {transform: translateY(-3px);}
        }
    </style>
</head>
<body>

    <button onclick="showInstallGuide()" class="install-btn">
        <i class="fas fa-download"></i> ä¸‹è¼‰ APP
    </button>

    <img src="/static/logo.png" class="main-logo" alt="Logo">
    
    <div class="app-title">
        <span style="font-family: 'Arial Black', sans-serif; font-size:2.8rem; color:#2d3436; letter-spacing: -2px; text-transform: uppercase; text-shadow: 2px 2px 0px #fff;">
            Map <span style="color:#d32f2f;">My God</span>
        </span><br>
        
        <span style="font-size:1.3rem; color:#555; font-weight:bold; letter-spacing: 2px; background: rgba(255,255,255,0.8); padding: 5px 15px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-top: 10px; display: inline-block;">
            è€ç¥åœ¨åœ¨ ğŸ™ˆ <span style="color:#d32f2f;">èº²è²“è²“</span>
        </span>
    </div>
    
    <p style="text-align:center; color:#666; font-size: 0.95rem; margin-top:-10px; margin-bottom:25px; font-weight: bold; line-height: 1.5;">
        ç¥‚è—åœ¨ç”°é ­ç”°å°¾...<br>
        <span style="color:#d63031;">å¿«æŠŠé‚£ä½ã€Œç¥éšŠå‹ã€æ‰¾å‡ºä¾†ï¼</span>
    </p>

    <a href="/upload" class="menu-btn" style="background: linear-gradient(135deg, #ff7675 0%, #d63031 100%); color:white; padding:15px; border-radius: 50px; box-shadow: 0 5px 15px rgba(214, 48, 49, 0.4); position:relative; overflow:visible;">
        <div style="font-size:1.3rem; font-weight:900; letter-spacing: 1px;">
            <i class="fas fa-camera"></i> å°‹æ‰¾åˆ°ç¥éšŠå‹
        </div>
        <div style="font-size:0.9rem; opacity:0.95; margin-top:3px;">
            è¶•å¿«å¹«ç¥‚æ‹å¼µç…§ ğŸ“¸
        </div>
        <span style="position:absolute; top:-10px; right:10px; background:#ffeaa7; color:#d63031; font-size:0.75rem; font-weight:bold; padding:3px 10px; border-radius:10px; transform:rotate(10deg); box-shadow:0 2px 5px rgba(0,0,0,0.2);">
            LUCKY!
        </span>
    </a>

    <a href="/map" class="menu-btn" style="background:#ffeaa7; color:#d35400; padding:12px; border-radius: 50px; font-weight:bold; margin-top:20px; border: 2px solid #fdcb6e;">
        <i class="fas fa-search-location"></i> æœå°‹éšŠå‹æ–¹ä½
        <div style="font-size:0.8rem; font-weight:normal; opacity:0.8; margin-top:2px;">
            çœ‹çœ‹ç¥‚å€‘èº²åœ¨å“ª ğŸ—ºï¸
        </div>
    </a>

    <a href="/gallery" class="menu-btn" style="background:#74b9ff; color:white; padding:12px; border-radius: 50px; font-weight:bold; margin-top:10px;">
        <i class="fas fa-images"></i> å°‹ç¥è¶³è·¡ï¼å½±åƒåº«
    </a>

    <div style="width:90%; max-width:350px; background:white; border-radius:15px; padding:15px; margin-top:25px; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
        <h5 style="font-weight:bold; color:#d32f2f; margin-bottom:15px; border-bottom:2px solid #eee; padding-bottom:10px;">
            <i class="fas fa-crown"></i> å°‹ç¥æ‰è¿·è—ï¼é«˜æ‰‹æ¦œ
            <a href="/leaderboard" style="float:right; font-size:0.8rem; color:#999; text-decoration:none; margin-top:3px;">çœ‹æ’å ></a>
        </h5>
        
        <ul class="list-group list-group-flush" id="mini-leaderboard">
            <li class="list-group-item text-center text-muted">è®€å–ä¸­...</li>
        </ul>
    </div>

    <div style="margin-top: 20px; margin-bottom: 20px; opacity: 0.3; text-align: center;">
        <a href="/login" style="color: #666; font-size: 1.5rem; text-decoration: none;" title="å»Ÿå…¬ç™»å…¥">
            <i class="fas fa-user-cog"></i>
        </a>
    </div>

    <div class="bottom-nav">
        <a href="/" class="nav-item active"><i class="fas fa-home"></i>é¦–é </a>
        <a href="/map" class="nav-item"><i class="fas fa-map-marked-alt"></i>åœ°åœ–</a>
        <a href="/gallery" class="nav-item"><i class="fas fa-images"></i>åœ–åº«</a>
        <a href="/leaderboard" class="nav-item"><i class="fas fa-list-ol"></i>æ¦œå–®</a>
    </div>

    <div class="modal fade" id="installModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="font-weight:bold;">ğŸ“² æŠŠåœŸåœ°å…¬å¸¶å›å®¶</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success" style="font-size:0.9rem;">
                        å®‰è£å¾Œå¯å…¨è¢å¹•ç€è¦½ï¼Œå°±åƒçœŸçš„ APP ä¸€æ¨£æ–¹ä¾¿ï¼
                    </div>
                    <div id="ios-guide" style="display:none;">
                        <h6 style="font-weight:bold; color:#007aff;"><i class="fab fa-apple"></i> iPhone ç”¨æˆ¶ï¼š</h6>
                        <ol style="padding-left:20px; line-height:1.8;">
                            <li>é»æ“Šä¸‹æ–¹ <b>ã€Œåˆ†äº«ã€</b> <i class="fas fa-external-link-alt"></i></li>
                            <li>é¸æ“‡ <b>ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</b> <i class="far fa-plus-square"></i></li>
                            <li>æŒ‰å³ä¸Šè§’ <b>ã€Œæ–°å¢ã€</b></li>
                        </ol>
                    </div>
                    <div id="android-guide" style="display:none;">
                        <h6 style="font-weight:bold; color:#3ddc84;"><i class="fab fa-android"></i> Android ç”¨æˆ¶ï¼š</h6>
                        <ol style="padding-left:20px; line-height:1.8;">
                            <li>é»æ“Šå³ä¸Šè§’ <b>ã€Œé¸å–®ã€</b> <i class="fas fa-ellipsis-v"></i></li>
                            <li>é¸æ“‡ <b>ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€</b> ğŸ“²</li>
                            <li>æŒ‰ä¸‹ <b>ã€Œå®‰è£ã€</b></li>
                        </ol>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">æˆ‘çŸ¥é“äº†</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(document).ready(function() {
            loadMiniLeaderboard();
        });

        function loadMiniLeaderboard() {
            $.getJSON('/api/locations', function(data) {
                var userCounts = {};
                data.forEach(item => {
                    var rawName = item.nickname || 'ç†±å¿ƒä¸²å‹'; 
                    var name = (rawName === 'åŒ¿å') ? 'ç†±å¿ƒä¸²å‹' : rawName;
                    userCounts[name] = (userCounts[name] || 0) + 1;
                });
                var sortedUsers = Object.entries(userCounts).sort((a,b) => b[1] - a[1]);

                var html = '';
                sortedUsers.slice(0, 3).forEach((item, index) => {
                    var icon = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index];
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center" style="padding:10px 15px;">
                            <span>${icon} <b>${item[0]}</b></span>
                            <span class="badge badge-light" style="color:#d63031; font-weight:bold;">${item[1]} å°Š</span>
                        </li>
                    `;
                });
                $('#mini-leaderboard').html(html);
            });
        }

        function showInstallGuide() {
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            var isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
            if (isIOS) { $('#ios-guide').show(); $('#android-guide').hide(); } 
            else { $('#ios-guide').hide(); $('#android-guide').show(); }
            $('#installModal').modal('show');
        }
    </script>
</body>
</html>
