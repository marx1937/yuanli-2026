<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map My God - å°‹ç¥æƒ…å ±ç«™</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { 
            background: linear-gradient(135deg, #fff1eb 0%, #ace0f9 100%);
            min-height: 100vh; display: flex; flex-direction: column; align-items: center;
            font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 100px;
        }

        /* é ‚éƒ¨æ¨™é¡Œèˆ‡èƒŒæ™¯å„ªåŒ– */
        .page-header { text-align: center; padding: 30px 0 20px 0; width: 100%; }
        .header-capsule {
            background: white; padding: 10px 25px; border-radius: 50px;
            font-weight: bold; color: #555; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: inline-flex; align-items: center; border: 1px solid rgba(255,255,255,0.8);
        }

        /* è¡¨å–®å¡ç‰‡ï¼šå¢åŠ æ·±åº¦æ„Ÿ */
        .form-card {
            background: rgba(255, 255, 255, 0.95); width: 92%; max-width: 450px;
            padding: 30px 25px; border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative; margin-top: 20px;
        }

        /* ğŸ“¸ ç›¸æ©Ÿå€å¡Šå„ªåŒ– */
        .upload-zone {
            border: 2px dashed #fab1a0; border-radius: 20px;
            padding: 35px 15px; text-align: center; background: #fffaf9;
            cursor: pointer; transition: all 0.3s; position: relative;
        }
        .upload-zone:active { background: #fff; border-color: #d32f2f; transform: scale(0.98); }
        .upload-icon { font-size: 3.2rem; color: #ff7675; margin-bottom: 12px; opacity: 0.8; }
        .upload-text { font-weight: bold; color: #d35400; font-size: 1.1rem; }
        #preview { width: 100%; border-radius: 15px; display: none; margin-top: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* å®šä½ç‹€æ…‹å°è—¥ä¸¸ */
        .gps-pill {
            background: white; padding: 6px 18px; border-radius: 50px;
            font-size: 0.85rem; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: inline-flex; align-items: center; margin-bottom: 20px; border: 1px solid #eee;
        }

        /* è¼¸å…¥æ¡†ç¾åŒ– */
        .form-label { font-weight: bold; color: #2d3436; margin-bottom: 8px; font-size: 0.95rem; }
        .custom-input {
            border-radius: 15px; border: 1px solid #eee; background: #fdfdfd;
            padding: 12px 18px; height: auto; font-size: 1rem; transition: 0.3s;
        }
        .custom-input:focus { border-color: #ff7675; box-shadow: 0 0 0 3px rgba(255, 118, 117, 0.1); background: white; }

        /* è¡Œå‹•æŒ‰éˆ•ï¼šæ‹‰é–‹èˆ‡åº•éƒ¨çš„è·é›¢ */
        .btn-submit {
            background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
            border: none; border-radius: 50px; padding: 16px; margin-top: 25px;
            font-weight: bold; letter-spacing: 2px; width: 100%; font-size: 1.2rem; color: white;
            box-shadow: 0 8px 20px rgba(214, 48, 49, 0.3);
        }
        .btn-submit:disabled { background: #dfe6e9; box-shadow: none; color: #b2bec3; }

        /* ğŸ§ å°å¹«æ‰‹ä½ç½®ä¿®æ­£ï¼šè®“å¥¹ç«™åœ¨å¡ç‰‡é‚Šç·£ï¼Œä¸å†ç ´åœ– */
        .helper-mascot {
            position: absolute; top: -75px; right: 10px;
            width: 100px; height: auto; z-index: 20;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.15));
            animation: float-helper 3s ease-in-out infinite;
        }
        @keyframes float-helper { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* åº•éƒ¨å°è¦½åˆ—ï¼šç¢ºä¿èˆ‡æŒ‰éˆ•æœ‰è¶³å¤ ç•™ç™½ */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #f1f1f1; 
            padding: 0 10px; height: 75px; display: flex; justify-content: space-around; align-items: center; 
            z-index: 999; box-shadow: 0 -5px 25px rgba(0,0,0,0.05);
        }
        .nav-item { text-align: center; color: #b2bec3; text-decoration: none; font-size: 0.7rem; flex: 1; display: flex; flex-direction: column; align-items: center; }
        .nav-item i { font-size: 1.4rem; margin-bottom: 3px; }
        .nav-item.active { color: #d32f2f; font-weight: bold; }
        .nav-center-btn {
            width: 68px; height: 68px; background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
            border-radius: 50%; border: 6px solid #fff; color: white; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; transform: translateY(-28px); box-shadow: 0 5px 15px rgba(214, 48, 49, 0.4);
        }
    </style>
</head>
<body>

    <div class="page-header">
        <div class="header-capsule">
            <i class="fas fa-camera-retro" style="color:#d32f2f; margin-right:10px;"></i> å°‹ç¥æƒ…å ±ç«™
        </div>
    </div>

    <div class="form-card">
        <img src="/static/up.png" class="helper-mascot" alt="å°å¹«æ‰‹">

        <form id="uploadForm">
            <input type="hidden" id="lat" name="lat">
            <input type="hidden" id="lng" name="lng">

            <div class="text-center">
                <div id="gpsStatus" class="gps-pill">
                    <i class="fas fa-satellite-dish fa-spin mr-2" style="color: #0984e3;"></i> è¡›æ˜Ÿå®šä½ä¸­...
                </div>
            </div>

            <div class="form-group text-center">
                <label for="photo" class="upload-zone">
                    <div id="uploadPlaceholder">
                        <i class="fas fa-camera upload-icon"></i><br>
                        <span class="upload-text">ğŸ“¸ æ•æ‰ç¥éšŠå‹é‡‘èº«</span><br>
                        <small class="text-muted">é»æ“Šé–‹å•Ÿç›¸æ©Ÿ</small>
                    </div>
                    <img id="preview" alt="é è¦½åœ–">
                    <input type="file" id="photo" name="photo" accept="image/*" capture="environment" style="display:none;" onchange="previewImage(this)">
                </label>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fas fa-map-marker-alt text-danger mr-1"></i> å‡ºæ²’å€åŸŸ (å¿…å¡«)</label>
                <select id="area" name="area" class="form-control custom-input" required>
                    <option value="" disabled selected>-- è«‹é¸æ“‡é‡Œåˆ¥ --</option>
                    <option value="è‹‘æ±é‡Œ">è‹‘æ±é‡Œ</option><option value="è‹‘å—é‡Œ">è‹‘å—é‡Œ</option><option value="è‹‘åŒ—é‡Œ">è‹‘åŒ—é‡Œ</option>
                    <option value="è¥¿å‹¢é‡Œ">è¥¿å‹¢é‡Œ</option><option value="ä¸­æ­£é‡Œ">ä¸­æ­£é‡Œ</option><option value="å®¢åº„é‡Œ">å®¢åº„é‡Œ</option>
                    <option value="è‹‘æ¸¯é‡Œ">è‹‘æ¸¯é‡Œ</option><option value="è¥¿å¹³é‡Œ">è¥¿å¹³é‡Œ</option><option value="æµ·å²¸é‡Œ">æµ·å²¸é‡Œ</option>
                    <option value="æˆ¿è£¡é‡Œ">æˆ¿è£¡é‡Œ</option><option value="æ–°å¾©é‡Œ">æ–°å¾©é‡Œ</option><option value="ç”°å¿ƒé‡Œ">ç”°å¿ƒé‡Œ</option>
                    <option value="èˆŠç¤¾é‡Œ">èˆŠç¤¾é‡Œ</option><option value="å±±è…³é‡Œ">å±±è…³é‡Œ</option><option value="ç¦ç”°é‡Œ">ç¦ç”°é‡Œ</option>
                    <option value="æ³°ç”°é‡Œ">æ³°ç”°é‡Œ</option><option value="ç‰ç”°é‡Œ">ç‰ç”°é‡Œ</option><option value="ä¸Šé¤¨é‡Œ">ä¸Šé¤¨é‡Œ</option>
                    <option value="å—å‹¢é‡Œ">å—å‹¢é‡Œ</option><option value="çŸ³é®é‡Œ">çŸ³é®é‡Œ</option><option value="è•‰åŸ”é‡Œ">è•‰åŸ”é‡Œ</option>
                    <option value="å±±æŸ‘é‡Œ">å±±æŸ‘é‡Œ</option><option value="ç¤¾è‹“é‡Œ">ç¤¾è‹“é‡Œ</option><option value="æ°´å¡é‡Œ">æ°´å¡é‡Œ</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fas fa-user-tag text-info mr-1"></i> å°‹ç¥äººå“¡ç°½åˆ° (é™8å­—)</label>
                <input type="text" class="form-control custom-input" id="nickname" name="nickname" maxlength="8" placeholder="ç†±å¿ƒä¸²å‹">
            </div>

            <div class="form-group mb-0">
                <label class="form-label"><i class="fas fa-pen-fancy text-warning mr-1"></i> ç·šç´¢æè¿° (é¸å¡«)</label>
                <textarea class="form-control custom-input" id="note" name="note" rows="2" placeholder="ä¾‹å¦‚ï¼šåœ¨æ¦•æ¨¹ä¸‹å¾ˆéˆé©—..."></textarea>
            </div>

            <button type="submit" class="btn btn-submit" id="submitBtn" disabled>
                <i class="fas fa-sync fa-spin"></i> ç­‰å¾… GPS å®šä½...
            </button>
        </form>
    </div>

    <div class="bottom-nav">
        <a href="/" class="nav-item"><i class="fas fa-archway"></i><span>é¦–é </span></a>
        <a href="/map" class="nav-item"><i class="fas fa-map-signs"></i><span>åœ°åœ–</span></a>
        <a href="/upload" class="nav-center-btn"><i class="fas fa-camera-retro" style="color:white;"></i></a>
        <a href="/gallery" class="nav-item"><i class="fas fa-images"></i><span>åœ–åº«</span></a>
        <a href="/leaderboard" class="nav-item"><i class="fas fa-scroll"></i><span>æ¦œå–®</span></a>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
    var currentLat = null, currentLng = null;

    // ğŸ”Š æ ¸å¿ƒåŠŸèƒ½ï¼šèªéŸ³æ’­å ±
    function speakHappy(text) {
        if ('speechSynthesis' in window) {
            var msg = new SpeechSynthesisUtterance();
            msg.text = text; msg.lang = 'zh-TW'; msg.rate = 1.0; 
            window.speechSynthesis.speak(msg);
        }
    }

    $(document).ready(function() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                currentLat = position.coords.latitude; currentLng = position.coords.longitude;
                $('#lat').val(currentLat); $('#lng').val(currentLng);
                $('#gpsStatus').html('<i class="fas fa-check-circle text-success mr-1"></i> å®šä½å®Œæˆ');
                checkReady();
            }, function() { 
                $('#gpsStatus').html('<i class="fas fa-exclamation-triangle text-warning mr-1"></i> å®šä½å¤±æ•—'); 
            }, { enableHighAccuracy: true });
        }
    });

    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $('#preview').attr('src', e.target.result).show();
                $('#uploadPlaceholder').hide();
                checkReady();
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function checkReady() {
        if (currentLat && $('#photo').val()) {
            $('#submitBtn').prop('disabled', false).html('<i class="fas fa-paper-plane"></i> ç™¼é€æƒ…å ±ï¼æ­¸æª”ï¼');
        } else if (currentLat) {
            $('#submitBtn').html('ğŸ“¸ è«‹å…ˆæ•æ‰é‡‘èº«');
        }
    }

    $('#uploadForm').submit(function(e) {
        e.preventDefault();
        var nickname = $('#nickname').val() || 'ç†±å¿ƒä¸²å‹';
        var area = $('#area').val();

        // ğŸ‘®â€â™‚ï¸ é«’è©±éæ¿¾å™¨
        var badWords = ['ç¬¨è›‹', 'å£è›‹', 'ç‹å…«', 'ç™½ç—´', 'å¹¹', 'æ­»', 'çˆ›', 'å±Œ', 'é›æ°', 'fuck', 'shit', 'bitch']; 
        for (var word of badWords) {
            if (nickname.toLowerCase().includes(word)) {
                Swal.fire({
                    imageUrl: '/static/377.jpg', imageWidth: '100%', imageHeight: 'auto',
                    title: 'æš±ç¨±ä¸å¤ªå¥½è½å–”...', text: 'è«‹æ›´æ›ä¸€å€‹å„ªé›…çš„åå­—ï¼',
                    confirmButtonColor: '#d33', confirmButtonText: 'OK'
                });
                return; 
            }
        }

        $('#submitBtn').html('<i class="fas fa-robot"></i> å‚³é€ä¸­...').prop('disabled', true);

        // æ¨¡æ“¬ä¸Šå‚³é‚è¼¯ (åŒ…å«é‡è¤‡æª¢æŸ¥ pada.jpg èˆ‡ æˆåŠŸ happy.jpg)
        setTimeout(function() {
            // é€™è£¡å¯ä»¥æ ¹æ“šå¾Œç«¯å›å‚³ status åˆ¤æ–·
            var isDuplicate = false; // æ¨¡æ“¬è®Šæ•¸

            if (isDuplicate) {
                Swal.fire({
                    imageUrl: '/static/pada.jpg', imageWidth: '100%', 
                    title: 'ğŸ“‹ è³‡æ–™å·²é€äº¤å¯©æ ¸',
                    html: `æ„Ÿè¬æ‚¨ï¼ä¸éæ­¤åœ°é»é™„è¿‘ä¼¼ä¹å·²æœ‰æŸ¥å ±ç´€éŒ„ã€‚<br>ç®¡ç†å“¡ç¢ºèªå¾Œå°±æœƒæ›´æ–°ï¼`,
                    confirmButtonText: 'æ”¶åˆ°ï¼', confirmButtonColor: '#ff9800'
                }).then(() => { window.location.href = '/map'; });
            } else {
                var sayText = 'æ„Ÿè¬ ' + area + ' çš„ ' + nickname + 'ï¼ŒåœŸåœ°å…¬æ”¶åˆ°å›‰ï¼';
                speakHappy(sayText); // ğŸ”Š èªéŸ³æ’­å ±
                Swal.fire({
                    title: 'âœ… ä¸Šå‚³æˆåŠŸï¼', text: sayText,
                    imageUrl: '/static/happy.jpg', imageWidth: '100%',
                    confirmButtonText: 'å¤ªæ£’äº†ï¼', confirmButtonColor: '#d32f2f'
                }).then(() => { window.location.href = '/map'; });
            }
        }, 1500);
    });
    </script>
</body>
</html>
