<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœŸåœ°å…¬è¦ªè¡›éšŠæ¦®è­½æ¦œ</title>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <style>
        body { 
            background-color: #fff8e1; /* æš–è‰²èƒŒæ™¯ */
            font-family: "Microsoft JhengHei", sans-serif; 
            padding-bottom: 50px;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— (ä»¿æ‰‹éŠæ’è¡Œæ¦œé¢¨æ ¼) */
        .header-bar {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: white; 
            padding: 25px 20px; 
            text-align: center;
            border-radius: 0 0 30px 30px; 
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        /* è¿”å›æŒ‰éˆ• */
        .back-btn {
            position: absolute; 
            top: 25px; 
            left: 20px; 
            color: white; 
            font-size: 1.2rem;
            background: rgba(255,255,255,0.2); 
            width: 40px; 
            height: 40px; 
            line-height: 40px;
            border-radius: 50%; 
            text-align: center; 
            text-decoration: none;
            transition: 0.2s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.4); color: white; }

        /* æ’è¡Œæ¦œå¡ç‰‡ */
        .rank-card {
            background: white; 
            border-radius: 20px;
            padding: 10px; 
            margin: 0 15px 30px 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            overflow: hidden;
            border-top: 5px solid #d32f2f;
        }

        /* è¡¨æ ¼æ¨£å¼å„ªåŒ– */
        .table td { 
            vertical-align: middle; 
            border-top: 1px solid #f8f8f8; 
            padding: 15px 10px;
        }

        /* åæ¬¡æ•¸å­—/åœ–ç¤º */
        .rank-icon { 
            font-size: 1.5rem; 
            width: 40px; 
            text-align: center; 
            display: inline-block;
        }
        
        /* å‰ä¸‰åå°ˆå±¬é¡è‰² */
        .gold { color: #FFD700; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); font-size: 1.8rem; }
        .silver { color: #C0C0C0; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); font-size: 1.6rem; }
        .bronze { color: #CD7F32; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); font-size: 1.6rem; }
        .normal-rank { 
            background: #eee; color: #555; 
            width: 28px; height: 28px; line-height: 28px; 
            border-radius: 50%; font-size: 0.9rem; font-weight: bold;
        }

        /* è¶¨å‹¢æ¨™ç±¤ (æ¯”è³½æ„Ÿé—œéµï¼) */
        .trend-tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; margin-left: 5px; font-weight: bold; display: inline-block;}
        .trend-hot { background: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2; } /* ç«ç†± */
        .trend-up { background: #e3f2fd; color: #1976d2; border: 1px solid #bbdefb; } /* ä¸Šå‡ */
        .trend-new { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; } /* æ–°é€² */

        .section-title {
            color: #d32f2f; 
            font-weight: bold; 
            margin: 0 0 10px 20px; 
            font-size: 1.1rem;
            display: flex; align-items: center;
        }
        .section-title i { margin-right: 8px; }

    </style>
</head>
<body>

    <div class="header-bar">
        <a href="/" class="back-btn"><i class="fas fa-chevron-left"></i></a>
        <h4 class="font-weight-bold mb-1">ğŸ† è¦ªè¡›éšŠæ¦®è­½æ¦œ</h4>
        <p class="mb-0 small" style="opacity: 0.9;">æ„Ÿè¬å®ˆè­·è‹‘è£¡åœŸåœ°å…¬çš„è‹±é›„å€‘ï¼</p>
    </div>

    <div class="container">
        
        <div class="section-title"><i class="fas fa-user-friends"></i> å€‹äººè²¢ç»æ¦œ (Top 10)</div>
        <div class="rank-card">
            <table class="table table-borderless mb-0">
                <thead style="border-bottom: 2px solid #f0f0f0;">
                    <tr style="color:#888; font-size:0.9rem;">
                        <th class="text-center" style="width: 60px;">æ’å</th>
                        <th>éšŠå“¡æš±ç¨± / è¶¨å‹¢</th>
                        <th class="text-right">æŸ¥å ±æ•¸</th>
                    </tr>
                </thead>
                <tbody id="user-list">
                    <tr><td colspan="3" class="text-center p-5"><i class="fas fa-spinner fa-spin"></i> è¼‰å…¥ä¸­...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section-title mt-4"><i class="fas fa-map-marked-alt"></i> æœ€ç†±è¡€é‡Œåˆ¥ (Top 10)</div>
        <div class="rank-card">
            <table class="table table-borderless mb-0">
                <thead style="border-bottom: 2px solid #f0f0f0;">
                    <tr style="color:#888; font-size:0.9rem;">
                        <th class="text-center" style="width: 60px;">æ’å</th>
                        <th>é‡Œåˆ¥åç¨±</th>
                        <th class="text-right">å·²ç™¼ç¾</th>
                    </tr>
                </thead>
                <tbody id="area-list">
                    <tr><td colspan="3" class="text-center p-5"><i class="fas fa-spinner fa-spin"></i> è¼‰å…¥ä¸­...</td></tr>
                </tbody>
            </table>
        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            // æŠ“å–å¾Œç«¯è³‡æ–™
            $.getJSON('/api/leaderboard_data', function(response) {
                renderTable('user-list', response.by_user, 'user');
                renderTable('area-list', response.by_area, 'area');
            });
        });

        function renderTable(elementId, data, type) {
            var html = '';
            
            // å¦‚æœæ²’è³‡æ–™
            if (!data || data.length === 0) {
                $('#' + elementId).html('<tr><td colspan="3" class="text-center p-4 text-muted">ç›®å‰é‚„æ²’æœ‰è³‡æ–™ï¼Œå¿«å»æ¶é ­é¦™ï¼</td></tr>');
                return;
            }

            // è¿´åœˆç”¢ç”Ÿåˆ—è¡¨ (æœ€å¤šé¡¯ç¤º 10 ç­†)
            $.each(data, function(index, item) {
                var rank = index + 1;
                var icon = `<span class="normal-rank">${rank}</span>`;
                var nameStyle = 'font-weight:bold; color:#444;';
                var countStyle = 'color:#d32f2f; font-weight:bold; font-size:1.1rem;';
                var trendTag = ''; // è¶¨å‹¢æ¨™ç±¤

                // ğŸ† å‰ä¸‰åç‰¹æ®Šæ¨£å¼ + è¶¨å‹¢é‚è¼¯
                if(rank === 1) { 
                    icon = '<i class="fas fa-crown gold"></i>'; 
                    nameStyle = 'font-weight:bold; color:#d32f2f; font-size:1.1rem;';
                    if(type === 'user') trendTag = '<div class="trend-tag trend-hot"><i class="fas fa-fire"></i> éœ¸æ¦œä¸­</div>';
                } 
                else if(rank === 2) { 
                    icon = '<i class="fas fa-medal silver"></i>'; 
                    if(type === 'user') trendTag = '<div class="trend-tag trend-up"><i class="fas fa-arrow-up"></i> è¿½è¶•ä¸­</div>';
                } 
                else if(rank === 3) { 
                    icon = '<i class="fas fa-medal bronze"></i>'; 
                    if(type === 'user') trendTag = '<div class="trend-tag trend-up"><i class="fas fa-arrow-up"></i> ä¸Šå‡</div>';
                } 
                else {
                    // 4-10å éš¨æ©Ÿé¡¯ç¤º "ä¸Šå‡" æˆ– "æ–°é€²æ¦œ" (å¢åŠ è¦–è¦ºè±å¯Œåº¦)
                    if(type === 'user') {
                        if(rank <= 5) trendTag = '<div class="trend-tag trend-up"><i class="fas fa-arrow-up"></i></div>';
                        else trendTag = '<div class="trend-tag trend-new">New</div>';
                    }
                }

                html += `
                    <tr>
                        <td class="text-center">${icon}</td>
                        <td>
                            <div style="${nameStyle}">${item.name}</div>
                            ${trendTag}
                        </td>
                        <td class="text-right">
                            <span style="${countStyle}">${item.count}</span>
                            <small style="color:#aaa;">è™•</small>
                        </td>
                    </tr>
                `;
            });
            $('#' + elementId).html(html);
        }
    </script>
</body>
</html>
