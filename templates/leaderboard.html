<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map My God - è‹±é›„æ¦œ</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { 
            background: linear-gradient(135deg, #fff1eb 0%, #ace0f9 100%);
            min-height: 100vh;
            font-family: "Microsoft JhengHei", sans-serif;
            padding-bottom: 90px;
        }
        
        .page-header { text-align: center; padding: 25px 0 15px 0; }

        .rank-card {
            width: 95%; max-width: 500px; margin: 0 auto;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .rank-header-bg {
            background: #d32f2f; color: white; padding: 15px;
            text-align: center; font-weight: bold; font-size: 1.1rem;
        }

        .rank-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 18px 15px;
            border-bottom: 1px solid #f1f2f6;
            transition: transform 0.2s;
        }
        .rank-item:last-child { border-bottom: none; }
        .rank-item:active { background: #fafafa; }

        .rank-circle {
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.1rem; margin-right: 12px;
            background: #eee; color: #777;
        }
        
        .rank-1 { background: #f1c40f; color: white; box-shadow: 0 2px 5px rgba(241, 196, 15, 0.4); font-size: 1.2rem; }
        .rank-2 { background: #95a5a6; color: white; }
        .rank-3 { background: #e67e22; color: white; }

        .user-info { flex-grow: 1; display: flex; flex-direction: column; }
        .user-name { font-weight: bold; color: #2d3436; font-size: 1.05rem; }
        
        /* ç¨±è™Ÿ Badge æ¨£å¼ */
        .title-badge {
            display: inline-block; font-size: 0.75rem; 
            padding: 3px 10px; border-radius: 12px; 
            margin-top: 4px; width: fit-content;
            font-weight: bold; letter-spacing: 0.5px;
        }
        .badge-king { background: #fff0f6; color: #e84393; border: 1px solid #e84393; } /* åœŸåœ°å…¬ç‹ */
        .badge-guard { background: #e8eaf6; color: #303f9f; border: 1px solid #303f9f; } /* ä¼¯å…¬è¦ªè¡›éšŠ */
        
        /* ğŸ”¥ æ–°å¢ï¼šå°‹ç¥æ¢éšªå®¶ (æ´»åŠ›æ©˜) */
        .badge-explorer { background: #fff3e0; color: #ef6c00; border: 1px solid #ef6c00; } 
        
        /* ğŸ”¥ æ–°å¢ï¼šå°‹ç¥å°èŒæ–° (å«©èŠ½ç¶ ) */
        .badge-newbie { background: #f1f8e9; color: #558b2f; border: 1px solid #558b2f; } 

        .count-area { text-align: right; }
        .count-num { font-size: 1.2rem; font-weight: bold; color: #d32f2f; }
        .count-label { font-size: 0.75rem; color: #999; }

        /* åº•éƒ¨å°è¦½åˆ— */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #eee; 
            padding: 0 10px; height: 70px; display: flex; justify-content: space-around; align-items: center; 
            z-index: 999; box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }
        .nav-item { text-align: center; color: #b2bec3; text-decoration: none; font-size: 0.7rem; flex: 1; display: flex; flex-direction: column; align-items: center; }
        .nav-item i { font-size: 1.4rem; margin-bottom: 2px; }
        .nav-item.active { color: #d32f2f; font-weight: bold; }
        
        .nav-center-btn {
            width: 65px; height: 65px; background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
            border-radius: 50%; border: 5px solid #f8f9fa; color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; box-shadow: 0 -5px 15px rgba(214, 48, 49, 0.3);
            transform: translateY(-25px); position: relative; z-index: 1000;
        }
        .nav-center-btn:hover { color: white; transform: translateY(-30px); }
    </style>
</head>
<body>

    <div class="page-header">
        <span style="background:white; padding:8px 25px; border-radius:30px; font-size:1.1rem; font-weight:bold; color:#555; box-shadow:0 4px 10px rgba(0,0,0,0.08); display: inline-flex; align-items: center;">
            <i class="fas fa-scroll" style="color:#d32f2f; margin-right:10px;"></i> å°‹ç¥æˆ°ç¸¾ï¼è‹±é›„æ¦œ
        </span>
    </div>

    <div class="rank-card">
        <div class="rank-header-bg">
            <i class="fas fa-trophy"></i> è²¢ç»è€…æ’è¡Œæ¦œ
        </div>
        
        <div id="leaderboard-list">
            <div class="text-center text-muted mt-4 mb-4">
                <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨è¨ˆç®—æˆ°ç¸¾...
            </div>
        </div>
    </div>

    <div class="text-center mt-4 text-muted" style="font-size:0.85rem; opacity:0.7;">
        åŠ æ²¹ï¼å¿«ä¾†åŠ å…¥ã€Œå°‹ç¥å°èŒæ–°ã€çš„è¡Œåˆ—ï¼ğŸŒ±
    </div>

    <div class="bottom-nav">
        <a href="/" class="nav-item"><i class="fas fa-archway"></i><span>é¦–é </span></a>
        <a href="/map" class="nav-item"><i class="fas fa-map-signs"></i><span>åœ°åœ–</span></a>
        <a href="/upload" class="nav-center-btn"><i class="fas fa-camera-retro"></i></a>
        <a href="/gallery" class="nav-item"><i class="fas fa-images"></i><span>åœ–åº«</span></a>
        <a href="/leaderboard" class="nav-item active"><i class="fas fa-scroll"></i><span>æ¦œå–®</span></a>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            $.getJSON('/api/locations', function(data) {
                var userCounts = {};
                
                // 1. çµ±è¨ˆ
                data.forEach(item => {
                    var rawName = item.nickname;
                    var name = (rawName && rawName.trim() !== '') ? rawName : 'ç†±å¿ƒä¸²å‹';
                    userCounts[name] = (userCounts[name] || 0) + 1;
                });

                // 2. æ’åº
                var sortedUsers = Object.entries(userCounts).sort((a,b) => b[1] - a[1]);

                // 3. æ¸²æŸ“
                var html = '';
                if(sortedUsers.length === 0) {
                    html = '<div class="text-center text-muted p-4">ç›®å‰é‚„æ²’æœ‰è‹±é›„ä¸Šæ¦œ<br>å¿«å»æ¶é ­é¦™ï¼</div>';
                } else {
                    sortedUsers.forEach((item, index) => {
                        var rank = index + 1;
                        var name = item[0];
                        var count = item[1];
                        
                        var rankClass = '';
                        if(rank === 1) rankClass = 'rank-1';
                        else if(rank === 2) rankClass = 'rank-2';
                        else if(rank === 3) rankClass = 'rank-3';

                        // ğŸ”¥ å°‹ç¥å®‡å®™ï¼ç¨±è™Ÿç³»çµ±
                        var badgeHtml = '';
                        if (rank === 1) {
                            badgeHtml = '<span class="title-badge badge-king">ğŸ‘‘ è‹‘è£¡åœŸåœ°å…¬ç‹</span>';
                        } else if (count >= 10) {
                            badgeHtml = '<span class="title-badge badge-guard">ğŸ›¡ï¸ ä¼¯å…¬è¦ªè¡›éšŠ</span>';
                        } else if (count >= 5) {
                            badgeHtml = '<span class="title-badge badge-explorer">ğŸ”­ å°‹ç¥æ¢éšªå®¶</span>';
                        } else {
                            badgeHtml = '<span class="title-badge badge-newbie">ğŸŒ± å°‹ç¥å°èŒæ–°</span>';
                        }

                        html += `
                            <div class="rank-item">
                                <div class="rank-circle ${rankClass}">${rank}</div>
                                <div class="user-info">
                                    <div class="user-name">${name}</div>
                                    <div>${badgeHtml}</div>
                                </div>
                                <div class="count-area">
                                    <div class="count-num">${count}</div>
                                    <div class="count-label">ç­†</div>
                                </div>
                            </div>
                        `;
                    });
                }
                $('#leaderboard-list').html(html);
            });
        });
    </script>
</body>
</html>
