<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœŸåœ°å…¬æ’è¡Œæ¦œ</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { background-color: #fff8e1; font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 80px; }
        .rank-card { border: none; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; overflow: hidden; }
        .card-header { background: #d32f2f; color: white; font-weight: bold; text-align: center; padding: 15px; }
        .list-group-item { border: none; border-bottom: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        /* å‰ä¸‰åçç‰Œ */
        .rank-badge { width: 30px; height: 30px; display: inline-flex; justify-content: center; align-items: center; border-radius: 50%; font-weight: bold; margin-right: 10px; color: white; }
        .rank-1 { background-color: #ffd700; box-shadow: 0 0 10px #ffd700; }
        .rank-2 { background-color: #c0c0c0; }
        .rank-3 { background-color: #cd7f32; }
        .rank-other { background-color: #eee; color: #666; font-size: 0.8rem; }

        /* ğŸ”¥ ç¨±è™Ÿå¾½ç« æ¨£å¼ */
        .title-badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 10px; margin-left: 5px; color: white; }
        .level-1 { background: #a29bfe; } /* å°å°ä¿¡å¾’ */
        .level-2 { background: #0984e3; } /* è™”èª é¦™å®¢ */
        .level-3 { background: #d63031; } /* å»Ÿå®‡é”äºº */
        .level-4 { background: linear-gradient(45deg, #FFD700, #FFA500); box-shadow: 0 2px 5px rgba(255, 215, 0, 0.4); } /* å®ˆè­·ç¥ */
        
        /* åº•éƒ¨å°è¦½åˆ— */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 10px 0; display: flex; justify-content: space-around; z-index: 999; }
        .nav-item { text-align: center; color: #666; text-decoration: none; font-size: 0.8rem; flex: 1; }
        .nav-item i { display: block; font-size: 1.2rem; margin-bottom: 2px; }
        .nav-item.active { color: #d32f2f; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container mt-4">
        <h3 class="text-center mb-4" style="font-weight: 800; color: #d32f2f;">
            <i class="fas fa-trophy"></i> åŠŸå¾·æ¦œ
        </h3>

        <div class="rank-card">
            <div class="card-header">ğŸ† è²¢ç»è€…æ’è¡Œæ¦œ</div>
            <ul class="list-group list-group-flush" id="user-rank-list">
                <li class="list-group-item text-center text-muted">çµ±è¨ˆä¸­...</li>
            </ul>
        </div>

        <div class="rank-card">
            <div class="card-header">ğŸš© æœ€ç†±è¡€çš„é‡Œ</div>
            <ul class="list-group list-group-flush" id="area-rank-list">
                <li class="list-group-item text-center text-muted">çµ±è¨ˆä¸­...</li>
            </ul>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="/" class="nav-item"><i class="fas fa-home"></i>é¦–é </a>
        <a href="/map" class="nav-item"><i class="fas fa-map-marked-alt"></i>åœ°åœ–</a>
        <a href="/gallery" class="nav-item"><i class="fas fa-images"></i>åœ–åº«</a>
        <a href="/leaderboard" class="nav-item active"><i class="fas fa-list-ol"></i>æ¦œå–®</a>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            $.getJSON('/api/locations', function(data) {
                // çµ±è¨ˆå€‹äºº
                var userCounts = {};
                data.forEach(item => {
                    var name = item.nickname || "åŒ¿å";
                    userCounts[name] = (userCounts[name] || 0) + 1;
                });
                var sortedUsers = Object.entries(userCounts).sort((a,b) => b[1] - a[1]);

                // çµ±è¨ˆåœ°å€
                var areaCounts = {};
                data.forEach(item => {
                    var area = item.area || "æœªçŸ¥";
                    areaCounts[area] = (areaCounts[area] || 0) + 1;
                });
                var sortedAreas = Object.entries(areaCounts).sort((a,b) => b[1] - a[1]);

                renderList('#user-rank-list', sortedUsers, true); // true ä»£è¡¨æ˜¯äºº(è¦é¡¯ç¤ºç¨±è™Ÿ)
                renderList('#area-rank-list', sortedAreas, false);
            });
        });

        // ğŸŒŸ ç¨±è™Ÿè¨ˆç®—ç³»çµ±
        function getTitleHtml(count) {
            if (count >= 50) return '<span class="title-badge level-4">ğŸ² åœŸåœ°å…¬å®ˆè­·ç¥</span>';
            if (count >= 20) return '<span class="title-badge level-3">ğŸ¯ å»Ÿå®‡é”äºº</span>';
            if (count >= 5)  return '<span class="title-badge level-2">ğŸ™ è™”èª é¦™å®¢</span>';
            return '<span class="title-badge level-1">ğŸ‘¶ å°å°ä¿¡å¾’</span>';
        }

        function renderList(selector, data, isUser) {
            var html = '';
            data.slice(0, 10).forEach((item, index) => {
                var rank = index + 1;
                var badgeClass = rank <= 3 ? `rank-${rank}` : 'rank-other';
                var icon = rank === 1 ? 'ğŸ”¥ ' : ''; // ç¬¬ä¸€ååŠ ç«ç„°
                
                // å¦‚æœæ˜¯å€‹äººæ¦œï¼ŒåŠ ä¸Šç¨±è™Ÿ
                var titleBadge = isUser ? getTitleHtml(item[1]) : '';

                html += `
                    <li class="list-group-item">
                        <div>
                            <span class="rank-badge ${badgeClass}">${rank}</span>
                            <span style="font-weight:bold; font-size:1.1rem;">${item[0]}</span>
                            ${titleBadge}
                        </div>
                        <span class="badge badge-pill badge-light" style="font-size:1rem;">
                            ${icon}${item[1]} ç­†
                        </span>
                    </li>
                `;
            });
            if(data.length === 0) html = '<li class="list-group-item text-center">ç›®å‰é‚„æ²’æœ‰è³‡æ–™</li>';
            $(selector).html(html);
        }
    </script>
</body>
</html>
