<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°‹ç¥åœ°åœ– - å°‹ç¥æƒ…å ±ç«™</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* ğŸ“œ é­”æ³•æ›¸è¦ç¯„ï¼šå…¨è¢å¹•åœ°åœ–æ¶æ§‹ */
        html, body { height: 100%; margin: 0; padding: 0; background-color: #fdfcf0; overflow: hidden; }
        #map { width: 100%; height: 100%; z-index: 1; }

        /* ğŸ”¥ UX é—œéµä¿®æ­£ï¼šæŠŠå°å¼•å½ˆçª—æŠ¬é«˜ï¼Œé¿å…èª¤è§¸ç›¸æ©Ÿ */
        .swal2-popup {
            margin-bottom: 110px !important; /* å‘ä¸Šæ¨é–‹ 110pxï¼Œå®Œç¾é¿é–‹å¤§ç›¸æ©Ÿ */
            border-radius: 25px !important;
            border: 2px solid #ffca28 !important; /* æ‹›è²¡é‡‘é‚Šæ¡† */
        }
        .swal2-title { color: #d32f2f !important; font-weight: 900 !important; }

        /* å½è£å°èˆªåˆ— (Fake Navbar) - è¦–è¦ºä¸€è‡´æ€§ */
        .fake-navbar { 
            position: fixed; bottom: 0; width: 100%; background: #fff; 
            border-top: 1px solid #efebe9; padding: 0 5px; height: 90px; 
            display: flex; justify-content: space-around; align-items: center; 
            z-index: 2000; box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }
        .nav-item { text-align: center; color: #a1887f; text-decoration: none !important; font-size: 0.75rem; flex: 1; display: flex; flex-direction: column; align-items: center; }
        .nav-icon { height: 42px; width: auto; margin-bottom: 3px; }
        .nav-item.active .nav-icon { transform: scale(1.1); filter: drop-shadow(0 2px 2px rgba(211,47,47,0.2)); }
        .nav-item.active span { color: #d32f2f; font-weight: bold; }

        /* ä¸­é–“å¤§ç›¸æ©ŸæŒ‰éˆ• */
        .nav-center-btn {
            width: 80px; height: 80px; background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
            border-radius: 50%; border: 6px solid #fdfcf0; display: flex; align-items: center; justify-content: center;
            transform: translateY(-35px); box-shadow: 0 8px 15px rgba(198, 40, 40, 0.3); text-decoration: none !important;
        }
        .nav-center-icon { height: 55px; width: auto; display: block; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); }

        /* å³å´åµéŒ¯é½’è¼ª */
        .debug-btn {
            position: fixed; right: 15px; top: 100px; z-index: 1500;
            width: 45px; height: 45px; background: #d32f2f; color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer;
        }

        /* åº•éƒ¨æ»‘å‡ºå¡ç‰‡ (Bottom Sheet) */
        #bottom-sheet {
            position: fixed; bottom: -100%; left: 0; width: 100%;
            background: white; border-radius: 25px 25px 0 0; z-index: 2100;
            transition: bottom 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 20px; box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
        }
        #bottom-sheet.open { bottom: 0; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="debug-btn" onclick="hardReset()">
        <i class="fas fa-cog fa-spin"></i>
    </div>

    <div class="fake-navbar">
        <a href="/" class="nav-item">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/nav_home.png" class="nav-icon"><span>é¦–é </span>
        </a>
        <a href="/map" class="nav-item active">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/nav_map.png" class="nav-icon"><span>åœ°åœ–</span>
        </a>
        <a href="/upload" class="nav-center-btn">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/nav_upload.png" class="nav-center-icon">
        </a>
        <a href="/gallery" class="nav-item">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/nav_gallery.png" class="nav-icon"><span>åœ–åº«</span>
        </a>
        <a href="/leaderboard" class="nav-item">
            <img src="https://res.cloudinary.com/diuoghid2/image/upload/v1/nav_leaderboard.png" class="nav-icon"><span>æ¦œå–®</span>
        </a>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
        // 1. åˆå§‹åŒ–åœ°åœ–
        var map = L.map('map', { zoomControl: false }).setView([24.44, 120.65], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // è§£æ±ºç ´åœ–é—œéµ
        setTimeout(() => { map.invalidateSize(); }, 500);

        // 2. é¡¯ç¤ºæ–°æ‰‹å¼•å°
        function showGuide() {
            Swal.fire({
                title: 'æ­¡è¿ä¾†åˆ°å°‹ç¥åœ°åœ–',
                html: `
                    <div style="text-align:left; font-size:0.95rem; line-height:1.8;">
                        ğŸ“ <b>é»æ“Šåœ–é‡˜</b>ï¼šçœ‹ç…§ç‰‡èˆ‡å°èˆª<br>
                        ğŸ¯ <b>ç„æº–æŒ‰éˆ•</b>ï¼šå°‹æ‰¾ä½ çš„ä½ç½®<br>
                        ğŸ“¸ <b>ä¸­é–“ç›¸æ©Ÿ</b>ï¼šä¸Šå‚³ç¥éšŠå‹æƒ…å ±<br>
                        âš™ï¸ <b>ç´…è‰²é½’è¼ª</b>ï¼šåœ°åœ–è³‡æ–™æ›´æ–°
                    </div>
                `,
                imageUrl: 'https://res.cloudinary.com/diuoghid2/image/upload/v1/guide_couple.png',
                imageWidth: 200,
                confirmButtonText: 'æ”¶åˆ°ï¼Œå‡ºç™¼å°‹ç¥ï¼',
                confirmButtonColor: '#e64a19'
            });
        }
        
        // åªæœ‰ç¬¬ä¸€æ¬¡é€²å…¥æœƒé¡¯ç¤º
        if(!localStorage.getItem('map_guided')) {
            showGuide();
            localStorage.setItem('map_guided', 'true');
        }

        // 3. åµéŒ¯åŠŸèƒ½ (Hard Reset)
        function hardReset() {
            Swal.fire({
                title: 'é‡æ•´åœ°åœ–è³‡æ–™ï¼Ÿ',
                text: 'å¦‚æœåœ°åœ–ä¸é †æˆ–ç ´åœ–ï¼Œè«‹æŒ‰ç¢ºå®šã€‚',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ç¢ºå®š',
                cancelButtonText: 'ä¸ç”¨'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear();
                    location.reload(true);
                }
            });
        }
    </script>
</body>
</html>
