{% extends "base.html" %}
{% set active_page = "map" %}

{% block title %}尋神地圖 - 靈感雷達{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

    <style>
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100vh; z-index: 1; background-color: #fdfcf0; }
        
        /* 廟宇紅匾額標題 */
        .map-header { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 900; width: 90%; max-width: 400px; text-align: center; }
        .header-badge {
            background: #d32f2f; color: #fff; padding: 10px 25px; border-radius: 50px; font-weight: bold; 
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3); display: inline-flex; align-items: center; border: 2px solid #fff8e1;
        }

        /* 小幫手遮罩 */
        #guideOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(93, 64, 55, 0.7); z-index: 2000; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .guide-card {
            background: #fff; width: 85%; max-width: 320px; border-radius: 30px; padding: 30px 25px; 
            text-align: center; border: 4px solid #fff8e1; box-shadow: 0 15px 40px rgba(0,0,0,0.3); animation: popUp 0.4s ease-out;
        }
        .guide-mascot { display: block; margin: 0 auto 20px auto; width: 150px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); }
        .guide-btn {
            background: linear-gradient(135deg, #f0932b 0%, #e67e22 100%); color: white; border: none; padding: 12px 0; border-radius: 50px;
            font-weight: bold; font-size: 1.1rem; width: 100%; box-shadow: 0 8px 20px rgba(230, 126, 34, 0.3);
        }

        /* 彈出視窗圓潤化 */
        .leaflet-popup-content-wrapper { border-radius: 20px; overflow: hidden; padding: 0; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .leaflet-popup-content { margin: 0; width: 250px !important; }
        .popup-img { width: 100%; height: 160px; object-fit: cover; background: #f5f5f5; }
        .popup-info { padding: 15px; color: #5d4037; }
        .popup-btn {
            background: #d32f2f; color: white !important; border-radius: 50px; 
            padding: 10px 0; display: block; text-align: center; font-weight: bold; margin-top: 10px;
        }

        /* 定位按鈕 */
        .btn-locate {
            position: absolute; bottom: 110px; right: 20px; z-index: 900;
            width: 55px; height: 55px; border-radius: 50%; background: white; color: #d32f2f; font-size: 1.5rem;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .simple-pin { font-size: 32px; filter: drop-shadow
